generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
  engineType    = "client"
  runtime = "bun"

}

datasource db {
  provider = "postgresql"
}


enum Role {
  OWNER
  ADMIN
  EDITOR
  VIEWER
}

enum AdStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
}

model User {
  id           String   @id @default(uuid())
  email        String   @unique
  passwordHash String
  firstName    String?
  lastName     String?
  isVerified   Boolean  @default(false)
  
  // Security field: increment this to invalidate ALL current JWTs/Sessions
  tokenVersion Int      @default(0) 

  members      Member[] 
  sessions     Sessions[] 

  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@index([email])
}

// workspace
model Tenant {
  id           String   @id @default(uuid())
  name         String
  tokenBalance Int      @default(0) 
  
  members      Member[]
  ads          Ad[]

  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}

model Member {
  id       String @id @default(uuid())
  role     Role   @default(VIEWER)
  userId   String
  tenantId String

  user     User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  tenant   Tenant @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())
  @@unique([userId, tenantId])
  @@index([tenantId]) // Optimized for checking all members of a workspace
}

model Sessions {
  id           String   @id @default(uuid())
  refreshToken String   @unique // Hashed version of the token for security
  userId       String
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  ipAddress    String?
  userAgent    String?
  
  expiresAt    DateTime
  createdAt    DateTime @default(now())

  @@index([userId])
}

model Ad {
  id         String   @id @default(uuid())
  tenantId   String
  prompt     String
  contentUrl String? 
  status     AdStatus @default(PENDING)

  tenant     Tenant   @relation(fields: [tenantId], references: [id])

  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@index([tenantId]) // Critical for tenant data isolation performance
}